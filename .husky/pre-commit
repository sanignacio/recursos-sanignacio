#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo 'ğŸ—ï¸ğŸ‘· Styling, testing and building your project before committing'

# Function to ask and run a command if the user agrees
ask_and_run() {
    local msg="$1"
    local cmd="$2"

    echo "$msg"
    read -p "ğŸ—‘ï¸ğŸ¤¡ Wanna see me fix your dumpster fire of code? (y/N): " answer
    case "$answer" in
        [Yy]* )
            echo "ğŸ› ï¸ğŸ”§ Alright, brace yourself, I'm doing this because clearly you can't... ğŸ¥±"
            $cmd
            if [ $? -ne 0 ]; then
                echo "âŒ Ugh, even my superior AI skills can't save this mess. Do it yourself, genius! ğŸ’¥ğŸ¤¡"
                exit 1
            else
                echo "ğŸ‰âœ¨ Look at that! I made your trash code sparkle like magic! ğŸª„âœ…"
            fi
            ;;
        * )
            echo "â›” Pff, coward. Go fix it yourself, mortal. ğŸ˜¤"
            exit 1
            ;;
    esac
}

# Check Prettier standards
pnpm run format:check || ask_and_run "ğŸ¤¢ğŸ¤® Prettier Check Failed." "pnpm run format:write"

# Check ESLint standards
pnpm run lint || ask_and_run "ğŸ˜¤ ESLint Check Failed." "pnpm run lint:fix"

# Check tsconfig standards
pnpm run typecheck || (
    echo 'ğŸ¤¡ğŸ˜‚âŒ Failed Type check. Please fix the TypeScript errors above.'
    exit 1
)

# Build
echo 'ğŸ¤”ğŸ¤”ğŸ¤”... Trying to build...'
pnpm run build || (
    echo 'âŒğŸ‘·ğŸ”¨ Build failed. Check errors above.'
    exit 1
)

echo 'âœ…âœ…âœ… All checks passed. Proceeding with commit.'
